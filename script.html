<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Lấy Transcript qua Worker</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
    textarea { width: 100%; height: 200px; }
    button { padding: 10px 20px; margin: 10px 0; }
    pre { background: #f7f7f7; padding: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Lấy Transcript YouTube (qua Worker)</h2>
  <p>Nhập danh sách URL YouTube (mỗi dòng một URL):</p>
  <textarea id="urlInput"></textarea>
  <br>
  <button onclick="processUrls()">Lấy transcript</button>
  <h3>Kết quả:</h3>
  <pre id="output"></pre>
  <button id="downloadBtn" style="display:none;" onclick="downloadFile()">Tải về dulieu.txt</button>

  <script>
    const WORKER_URL = "https://script.nghnampro.workers.dev/";

    // Hàm tách video ID từ URL
    function extractVideoId(url) {
      const match = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
      return match ? match[1] : null;
    }

    async function processUrls() {
      const urls = document.getElementById("urlInput").value.split("\n").map(x => x.trim()).filter(Boolean);
      const ids = urls.map(extractVideoId).filter(Boolean);

      if (!ids.length) {
        alert("Không tìm thấy ID video hợp lệ.");
        return;
      }

      // Ghép query string
      const query = "?ids=" + ids.join(",");
      const fullUrl = WORKER_URL + query;

      try {
        const resp = await fetch(fullUrl);
        if (!resp.ok) throw new Error("HTTP " + resp.status);
        const text = await resp.text();

        document.getElementById("output").textContent = text;
        document.getElementById("downloadBtn").style.display = "inline-block";
        window.transcriptText = text; // lưu để tải
      } catch (err) {
        document.getElementById("output").textContent = "Lỗi: " + err.message;
      }
    }

    function downloadFile() {
      const blob = new Blob([window.transcriptText], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "dulieu.txt";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
